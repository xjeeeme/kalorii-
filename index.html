<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Трекер калорий</title>
<style>
  /* Основные шрифты и цвета */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

  :root {
    --color-bg-light: #f5f5f7;
    --color-bg-dark: #1c1c1e;
    --color-text-light: #1d1d1f;
    --color-text-dark: #f0f0f3;
    --color-accent: #0071e3;
    --color-accent-hover: #005bb5;
    --color-card-light: #ffffff;
    --color-card-dark: #2c2c2e;
    --border-radius: 16px;
    --transition: 0.3s ease;
  }

  body {
    margin: 0;
    background-color: var(--color-bg-light);
    color: var(--color-text-light);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 30px 15px;
    min-height: 100vh;
    transition: background-color var(--transition), color var(--transition);
  }

  body.dark {
    background-color: var(--color-bg-dark);
    color: var(--color-text-dark);
  }

  h1 {
    font-weight: 600;
    font-size: 2.4rem;
    margin-bottom: 25px;
    user-select: none;
  }

  .container {
    max-width: 480px;
    width: 100%;
    background-color: var(--color-card-light);
    border-radius: var(--border-radius);
    padding: 25px 25px 40px;
    box-shadow: 0 10px 30px rgb(0 0 0 / 0.1);
    transition: background-color var(--transition);
  }

  body.dark .container {
    background-color: var(--color-card-dark);
    box-shadow: 0 10px 30px rgb(255 255 255 / 0.1);
  }

  form {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 20px;
  }

  input[type="text"],
  input[type="number"] {
    flex: 1 1 140px;
    padding: 12px 16px;
    font-size: 1rem;
    border: 1.8px solid #ccc;
    border-radius: var(--border-radius);
    transition: border-color var(--transition), background-color var(--transition), color var(--transition);
    outline-offset: 2px;
  }

  body.dark input[type="text"],
  body.dark input[type="number"] {
    background-color: #3a3a3c;
    border-color: #555;
    color: var(--color-text-dark);
  }

  input[type="text"]::placeholder,
  input[type="number"]::placeholder {
    color: #999;
  }

  button {
    padding: 12px 28px;
    background-color: var(--color-accent);
    color: white;
    font-weight: 600;
    font-size: 1rem;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    user-select: none;
    transition: background-color var(--transition), box-shadow var(--transition);
    flex: 1 1 120px;
    min-width: 120px;
  }

  button:hover,
  button:focus {
    background-color: var(--color-accent-hover);
    box-shadow: 0 4px 15px rgba(0, 113, 227, 0.6);
  }

  #toggleThemeBtn {
    margin-bottom: 20px;
    background-color: transparent;
    color: var(--color-accent);
    font-weight: 600;
    border: 2px solid var(--color-accent);
    flex: unset;
    min-width: unset;
    padding: 8px 20px;
  }

  #toggleThemeBtn:hover {
    background-color: var(--color-accent);
    color: white;
  }

  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 10px;
  }

  thead th {
    text-align: left;
    padding-left: 15px;
    font-weight: 600;
    color: var(--color-accent);
    user-select: none;
    font-size: 0.9rem;
  }

  tbody tr {
    background-color: var(--color-card-light);
    border-radius: var(--border-radius);
    box-shadow: 0 3px 8px rgb(0 0 0 / 0.05);
    transition: background-color var(--transition);
  }

  body.dark tbody tr {
    background-color: var(--color-card-dark);
    box-shadow: 0 3px 8px rgb(255 255 255 / 0.1);
  }

  tbody tr td {
    padding: 12px 15px;
    font-size: 1rem;
    vertical-align: middle;
    color: var(--color-text-light);
  }

  body.dark tbody tr td {
    color: var(--color-text-dark);
  }

  tbody tr td:last-child {
    width: 48px;
    text-align: center;
  }

  .deleteBtn {
    background: none;
    border: none;
    color: #d32f2f;
    font-weight: 700;
    font-size: 1.2rem;
    cursor: pointer;
    transition: color 0.3s ease;
  }

  .deleteBtn:hover {
    color: #9a0000;
  }

  #totalStats {
    margin-top: 30px;
    font-weight: 600;
    font-size: 1.2rem;
    user-select: none;
  }

  /* Анимация плавного появления записи */
  @keyframes fadeInSlide {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  tbody tr {
    animation: fadeInSlide 0.35s ease forwards;
  }

  /* Адаптив для телефона */
  @media (max-width: 480px) {
    body {
      padding: 20px 12px;
    }
    .container {
      padding: 20px 20px 35px;
      max-width: 100%;
    }
    input[type="text"],
    input[type="number"] {
      flex-basis: 100%;
    }
    button {
      flex-basis: 100%;
      min-width: auto;
    }
    thead {
      display: none;
    }
    tbody tr {
      display: grid;
      grid-template-columns: 1fr auto;
      padding: 12px 15px;
      margin-bottom: 12px;
      border-radius: var(--border-radius);
      box-shadow: 0 3px 8px rgb(0 0 0 / 0.05);
      background-color: var(--color-card-light);
      color: var(--color-text-light);
    }
    body.dark tbody tr {
      background-color: var(--color-card-dark);
      color: var(--color-text-dark);
      box-shadow: 0 3px 8px rgb(255 255 255 / 0.1);
    }
    tbody tr td {
      padding: 0;
      font-size: 1rem;
      line-height: 1.3;
    }
    tbody tr td:nth-child(1) {
      grid-column: 1 / 2;
      font-weight: 600;
      margin-bottom: 4px;
    }
    tbody tr td:nth-child(2),
    tbody tr td:nth-child(3) {
      text-align: right;
      grid-column: 2 / 3;
    }
    tbody tr td:last-child {
      grid-column: 2 / 3;
      text-align: right;
      padding-right: 0;
      margin-left: 8px;
      align-self: center;
    }
  }
</style>
</head>
<body>

<h1>Трекер калорий</h1>

<div class="container">
  <button id="toggleThemeBtn" aria-label="Переключить тему">Тёмная тема</button>

  <form id="foodForm">
    <input type="text" id="foodInput" placeholder="Что съел?" autocomplete="off" required />
    <input type="number" id="caloriesInput" placeholder="Ккал" min="0" step="1" required />
    <input type="number" id="proteinInput" placeholder="Белки (г)" min="0" step="0.1" required />
    <input type="number" id="fatInput" placeholder="Жиры (г)" min="0" step="0.1" required />
    <input type="number" id="carbInput" placeholder="Углеводы (г)" min="0" step="0.1" required />
    <button type="submit">Добавить</button>
  </form>

  <table aria-label="Список продуктов и калорий">
    <thead>
      <tr>
        <th>Продукт</th>
        <th>Ккал</th>
        <th>Б</th>
        <th>Ж</th>
        <th>У</th>
        <th>Удалить</th>
      </tr>
    </thead>
    <tbody id="foodList">
      <!-- Здесь будут строки с едой -->
    </tbody>
  </table>

  <div id="totalStats" aria-live="polite">
    Всего: 0 Ккал | 0 г Белков | 0 г Жиров | 0 г Углеводов
  </div>
</div>

<script>
(() => {
  const foodForm = document.getElementById('foodForm');
  const foodInput = document.getElementById('foodInput');
  const caloriesInput = document.getElementById('caloriesInput');
  const proteinInput = document.getElementById('proteinInput');
  const fatInput = document.getElementById('fatInput');
  const carbInput = document.getElementById('carbInput');
  const foodList = document.getElementById('foodList');
  const totalStats = document.getElementById('totalStats');
  const toggleThemeBtn = document.getElementById('toggleThemeBtn');

  // Состояние - массив объектов {id, food, calories, protein, fat, carbs}
  let foods = [];

  // Загрузка из localStorage
  function loadFoods() {
    const saved = localStorage.getItem('calorieTrackerFoods');
    if (saved) {
      foods = JSON.parse(saved);
    }
  }

  // Сохранение в localStorage
  function saveFoods() {
    localStorage.setItem('calorieTrackerFoods', JSON.stringify(foods));
  }

  // Обновить табличку и итоги
  function renderFoods() {
    foodList.innerHTML = '';
    let totalCalories = 0, totalProtein = 0, totalFat = 0, totalCarbs = 0;
    for (const item of foods) {
      totalCalories += item.calories;
      totalProtein += item.protein;
      totalFat += item.fat;
      totalCarbs += item.carbs;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.food}</td>
        <td>${item.calories}</td>
        <td>${item.protein.toFixed(1)}</td>
        <td>${item.fat.toFixed(1)}</td>
        <td>${item.carbs.toFixed(1)}</td>
        <td><button class="deleteBtn" aria-label="Удалить ${item.food}">×</button></td>
      `;
      // Удаление по кнопке
      tr.querySelector('button.deleteBtn').addEventListener('click', () => {
        foods = foods.filter(f => f.id !== item.id);
        saveFoods();
        renderFoods();
      });
      foodList.appendChild(tr);
    }

    totalStats.textContent = `Всего: ${totalCalories} Ккал | ${totalProtein.toFixed(1)} г Белков | ${totalFat.toFixed(1)} г Жиров | ${totalCarbs.toFixed(1)} г Углеводов`;
  }

  // Добавить новую запись
  foodForm.addEventListener('submit', e => {
    e.preventDefault();

    const food = foodInput.value.trim();
    const calories = Number(caloriesInput.value);
    const protein = Number(proteinInput.value);
    const fat = Number(fatInput.value);
    const carbs = Number(carbInput.value);

    if (!food || calories < 0 || protein < 0 || fat < 0 || carbs < 0) {
      alert('Пожалуйста, заполните все поля корректно');
      return;
    }

    const newFood = {
      id: Date.now(),
      food,
      calories,
      protein,
      fat,
      carbs
    };

    foods.push(newFood);
    saveFoods();
    renderFoods();

    foodForm.reset();
    foodInput.focus();
  });

  // Тёмная тема из localStorage или по умолчанию светлая
  function loadTheme() {
    const theme = localStorage.getItem('calorieTrackerTheme');
    if (theme === 'dark') {
      document.body.classList.add('dark');
      toggleThemeBtn.textContent = 'Светлая тема';
    }
  }

  // Переключение темы
  toggleThemeBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    if (document.body.classList.contains('dark')) {
      toggleThemeBtn.textContent = 'Светлая тема';
      localStorage.setItem('calorieTrackerTheme', 'dark');
    } else {
      toggleThemeBtn.textContent = 'Тёмная тема';
      localStorage.setItem('calorieTrackerTheme', 'light');
    }
  });

  // Инициализация
  loadTheme();
  loadFoods();
  renderFoods();
})();
</script>

</body>
</html>
