<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Трекер калорий с историей</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Общие стили */
    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: #f9f9f9;
      color: #111;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px 10px 40px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
    }

    h1 {
      font-weight: 600;
      font-size: 1.8rem;
      margin: 0 0 10px;
      text-align: center;
      color: #222;
    }

    #app {
      width: 100%;
      max-width: 430px; /* Под iPhone 13 mini и аналогичные */
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgb(0 0 0 / 0.1);
      padding: 20px 20px 30px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    label {
      font-weight: 600;
      margin-bottom: 4px;
      display: block;
      color: #333;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"] {
      width: 100%;
      padding: 10px 12px;
      font-size: 1rem;
      border: 1.5px solid #ddd;
      border-radius: 10px;
      outline-offset: 2px;
      outline-color: transparent;
      transition: outline-color 0.3s ease, border-color 0.3s ease;
      box-sizing: border-box;
    }
    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus {
      outline-color: #007aff;
      border-color: #007aff;
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px 12px;
      align-items: flex-end;
    }

    form > div {
      display: flex;
      flex-direction: column;
    }

    form > div.full-width {
      grid-column: 1 / -1;
    }

    button {
      grid-column: 1 / -1;
      padding: 12px 0;
      background: #007aff;
      color: #fff;
      font-weight: 600;
      font-size: 1.1rem;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
      box-shadow: 0 5px 12px rgb(0 122 255 / 0.45);
    }
    button:hover {
      background: #005ecb;
      box-shadow: 0 7px 18px rgb(0 94 203 / 0.6);
    }
    button:active {
      background: #004299;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
      font-size: 0.95rem;
      color: #222;
    }

    thead tr {
      background: transparent;
    }

    thead th {
      text-align: left;
      font-weight: 600;
      padding-bottom: 8px;
      color: #555;
      font-size: 0.85rem;
      user-select: none;
    }

    tbody tr {
      background: #f5f5f7;
      border-radius: 14px;
      box-shadow: 0 1px 2px rgb(0 0 0 / 0.08);
      transition: background-color 0.2s ease;
    }

    tbody tr:hover {
      background: #e4ebfa;
    }

    tbody td {
      padding: 10px 12px;
      vertical-align: middle;
    }

    tbody td:first-child {
      font-weight: 600;
      max-width: 140px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    tbody td:last-child {
      text-align: center;
      cursor: pointer;
      color: #d33;
      font-weight: 700;
      user-select: none;
      font-size: 1.3rem;
      line-height: 1;
      padding-right: 16px;
      transition: color 0.3s ease;
    }
    tbody td:last-child:hover {
      color: #a00;
    }

    #totalStats {
      font-weight: 600;
      font-size: 1.05rem;
      padding-top: 8px;
      color: #222;
      border-top: 1px solid #ddd;
      user-select: none;
    }

    #historyDate {
      width: 100%;
      max-width: 200px;
      margin: 0 auto 12px;
      padding: 10px 12px;
      font-size: 1rem;
      border: 1.5px solid #ddd;
      border-radius: 12px;
      outline-offset: 2px;
      outline-color: transparent;
      transition: outline-color 0.3s ease, border-color 0.3s ease;
      display: block;
    }
    #historyDate:focus {
      outline-color: #007aff;
      border-color: #007aff;
    }

    /* Адаптивность */
    @media (max-width: 430px) {
      body {
        padding: 12px 8px 30px;
      }
      #app {
        max-width: 100%;
        padding: 15px 15px 25px;
      }
      form {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      button {
        grid-column: 1;
        font-size: 1rem;
      }
      table {
        font-size: 0.9rem;
      }
      tbody td:first-child {
        max-width: 120px;
      }
      #historyDate {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>

  <h1>Трекер калорий с историей</h1>
  <div id="app" role="main" aria-label="Трекер калорий с выбором даты и историей">
    <form id="foodForm" aria-describedby="formDesc">
      <div class="full-width">
        <label for="dateInput">Дата</label>
        <input type="date" id="dateInput" value="" aria-required="true" />
      </div>
      <div>
        <label for="foodInput">Еда</label>
        <input id="foodInput" type="text" placeholder="Название продукта" required aria-required="true" />
      </div>
      <div>
        <label for="caloriesInput">Калории (Ккал)</label>
        <input id="caloriesInput" type="number" min="0" placeholder="Например, 250" required aria-required="true" />
      </div>
      <div>
        <label for="proteinInput">Белки (г) <small>(не обязательно)</small></label>
        <input id="proteinInput" type="number" min="0" placeholder="0" />
      </div>
      <div>
        <label for="fatInput">Жиры (г) <small>(не обязательно)</small></label>
        <input id="fatInput" type="number" min="0" placeholder="0" />
      </div>
      <div>
        <label for="carbInput">Углеводы (г) <small>(не обязательно)</small></label>
        <input id="carbInput" type="number" min="0" placeholder="0" />
      </div>
      <button type="submit" aria-label="Добавить продукт">Добавить</button>
    </form>

    <label for="historyDate">Выбери дату для просмотра истории</label>
    <input type="date" id="historyDate" aria-live="polite" />

    <table role="table" aria-label="Список продуктов">
      <thead>
        <tr>
          <th>Еда</th>
          <th>Ккал</th>
          <th>Белки</th>
          <th>Жиры</th>
          <th>Углеводы</th>
          <th>Удалить</th>
        </tr>
      </thead>
      <tbody id="foodList">
        <!-- Продукты сюда -->
      </tbody>
    </table>

    <div id="totalStats" aria-live="polite" aria-atomic="true">
      Всего: 0 Ккал | 0 г Белков | 0 г Жиров | 0 г Углеводов
    </div>
  </div>

<script>
(() => {
  const foodForm = document.getElementById('foodForm');
  const dateInput = document.getElementById('dateInput');
  const foodInput = document.getElementById('foodInput');
  const caloriesInput = document.getElementById('caloriesInput');
  const proteinInput = document.getElementById('proteinInput');
  const fatInput = document.getElementById('fatInput');
  const carbInput = document.getElementById('carbInput');
  const foodList = document.getElementById('foodList');
  const totalStats = document.getElementById('totalStats');
  const historyDate = document.getElementById('historyDate');

  // Установим дату по умолчанию - сегодня
  const today = new Date().toISOString().slice(0, 10);
  dateInput.value = today;
  historyDate.value = today;

  // Загрузить данные из localStorage для даты
  function loadData(date) {
    const data = localStorage.getItem('calorieTracker-' + date);
    return data ? JSON.parse(data) : [];
  }

  // Сохранить данные в localStorage для даты
  function saveData(date, items) {
    localStorage.setItem('calorieTracker-' + date, JSON.stringify(items));
  }

  // Обновить таблицу и сумму
  function updateTable(date) {
    const items = loadData(date);
    foodList.innerHTML = '';
    let sumCalories = 0, sumProtein = 0, sumFat = 0, sumCarb = 0;

    items.forEach((item, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td title="${item.food}">${item.food}</td>
        <td>${item.calories}</td>
        <td>${item.protein || 0}</td>
        <td>${item.fat || 0}</td>
        <td>${item.carb || 0}</td>
        <td role="button" aria-label="Удалить ${item.food}" tabindex="0" style="color:#d33; cursor:pointer;">&times;</td>
      `;
      // Обработка удаления
      tr.querySelector('td:last-child').addEventListener('click', () => {
        items.splice(index, 1);
        saveData(date, items);
        updateTable(date);
      });
      // Удаление с клавиатуры (Enter/Space)
      tr.querySelector('td:last-child').addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          items.splice(index, 1);
          saveData(date, items);
          updateTable(date);
        }
      });

      foodList.appendChild(tr);

      sumCalories += Number(item.calories);
      sumProtein += Number(item.protein || 0);
      sumFat += Number(item.fat || 0);
      sumCarb += Number(item.carb || 0);
    });

    totalStats.textContent = `Всего: ${sumCalories} Ккал | ${sumProtein} г Белков | ${sumFat} г Жиров | ${sumCarb} г Углеводов`;
  }

  // При добавлении еды
  foodForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const date = dateInput.value;
    const food = foodInput.value.trim();
    const calories = caloriesInput.value.trim();
    // Белки, жиры, углеводы необязательны, если пусто — 0
    const protein = proteinInput.value.trim() || '0';
    const fat = fatInput.value.trim() || '0';
    const carb = carbInput.value.trim() || '0';

    if(!date || !food || !calories) {
      alert('Пожалуйста, заполните дату, еду и калории.');
      return;
    }

    const items = loadData(date);
    items.push({ food, calories: Number(calories), protein: Number(protein), fat: Number(fat), carb: Number(carb) });
    saveData(date, items);
    updateTable(date);

    foodInput.value = '';
    caloriesInput.value = '';
    proteinInput.value = '';
    fatInput.value = '';
    carbInput.value = '';
  });

  // При смене даты просмотра истории
  historyDate.addEventListener('change', () => {
    updateTable(historyDate.value);
    dateInput.value = historyDate.value;
  });

  // При смене даты добавления — синхронизируем с историей
  dateInput.addEventListener('change', () => {
    historyDate.value = dateInput.value;
    updateTable(dateInput.value);
  });

  // Загрузка при старте
  updateTable(today);
})();
</script>

</body>
</html>
